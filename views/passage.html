<%include header.html %>
<%include left_navbar.html %>
        <form class="form-horizontal" role="form" method="post" enctype="multipart/form-data" action="passage">
            <div class="form-group">
                <label for="title" class="col-sm-2 control-label">标题</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="title" name="title" placeholder="请输入标题">
                </div>
            </div>
            <div class="form-group">
                <label for="file" class="col-sm-2 control-label">上传图片</label>
                <div class="col-sm-10 pic">
                    <input style="width:100px;" type="file" onchange="preview(this)" class="form-control" id="file" name="file">
                    <div id="pic"></div>
                </div>
            </div>
            <div class="form-group">
                <label for="className" class="col-sm-2 control-label">文章分类</label>
                <div class="col-sm-3">
                    <select class="form-control" id="className" name="className">
                        <% for (a = 0;a< arr.length;a++) { %>
                        <option value ="<%= arr[a].classId%>"><%= arr[a].className%></option>
                        <% }%>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="time" class="col-sm-2 control-label">发布时间</label>
                <div class="col-sm-10">
                    <input style="width:100px;" type="text" onClick="laydate()" value="" placeholder="发布时间" class="form-control" id="time" name="time">
                </div>
            </div>
            <div class="form-group">
                <label for="content" class="col-sm-2 control-label">内容</label>
                <div class="col-sm-10">
                    <textarea id="content" name="content" class="ckeditor" placeholder="请输入内容"></textarea>
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button type="submit" class="btn btn-default">提交</button>
                </div>
            </div>
        </form>
        <script src="https://cdn.bootcss.com/ckeditor/4.8.0/ckeditor.js"></script>
<script type="text/javascript">
    $(function(){
        $("#back").click(function(){
            location.href = 'home';
        });
//        $('#file').change(function(event) {
//            /* Act on the event */
//            if ($('#file').val().length) {
//                var fileName = $('#file').val();
//                var extension = fileName.substring(fileName.lastIndexOf('.'), fileName.length).toLowerCase();
//                console.log(extension);
//                if (extension == ".jpg" || extension == ".png") {
//                    var data = new FormData();
//                    data.append('upload', $('#file')[0].files[0]);
//                    $.ajax({
//                        url: '/upload',
//                        type: 'post',
//                        data: data,
//                        cache: false,
//                        contentType: false, //不可缺参数
//                        processData: false, //不可缺参数
//                        success: function(data) {
//                            console.log(data);
//                            alert("提交表单成功！");
//                        },
//                        error: function() {
//                            console.log(data);
//                            console.log('error');
//                            alert("提交失败！");
//                        }
//                    });
//                }
//            }
//        });

//        $("#submit").click(function(){
//            var title = $("#title").val();
//            var file = $("#file").val();
//            console.log(file);
//            var content = $("#content").val();
//            var data = {"title":title,"file":file,"content":content};
//            console.log(data);
//            $.ajax({
//                url: '/passage',
//                type: 'post',
//                data: data,
//                success: function(data,status){
//                    if(status == 'success'){
//                        alert("提交表单成功！");
//                        location.href = 'passage';
//                    }
//                },
//                error: function(data,err){
//                    console.log(data);
//                    console.log(data.title);
//                    alert("提交失败！");
//                    location.href = 'passage';
//                }
//            });
//        });
    });
</script>
<%include left_navEnd.html %>
<script>
    $(".col-sm-2.col-md-2 .list-group").find("li").eq(3).addClass("list-group-item-danger");
    function preview(file){
        var prevDiv = document.getElementById('pic');
        if (file.files && file.files[0]) {
            var reader = new FileReader();
            reader.onload = function (evt) {
                prevDiv.innerHTML = '<div class="img_input_box"><img style="height:50px;" src="' + evt.target.result + '" /></div>';
            };
            reader.readAsDataURL(file.files[0]);
        } else {
            prevDiv.innerHTML = '<div class="img" style="filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale,src=\'' + file.value + '\'"></div>';
        }
    }
</script>
<%include footer.html %>